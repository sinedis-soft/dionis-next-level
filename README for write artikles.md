Ниже — практичный гайд **как писать `.mdx` под вашу текущую архитектуру** (Next.js + `next-mdx-remote/rsc` + `remark-gfm`, плюс ваши компоненты в `components/blog/mdx/*` и блоки в `components/blog/mdx/blocks/*`). Буду опираться на то, **что уже есть в коде**: `Callout`, `Cta`, `InlineCta`, `Table`, `Term`, MDX-таблицы (`MdxTable*`), автогенерация TOC из `##/###`, FAQ/JSON-LD, required/next связи, version/changelog.

---

## 1) Где лежат статьи и как называется файл

Статьи должны лежать так:

```
/content/blog/{lang}/{slug}.mdx
```

* `{lang}`: `ru | kz | en`
* `{slug}`: совпадает с `frontmatter.slug` и с именем файла.

Пример:

```
content/blog/ru/kak-vybrat-kasko-v-kazahstane.mdx
```

Маршрут статьи автоматически:

```
/ru/blog/kak-vybrat-kasko-v-kazahstane
```

---

## 2) Обязательный frontmatter: минимальный рабочий шаблон

Это **минимум**, без него `parseFrontmatter()` бросит ошибку (slug/title/seoDescription обязательны):

```mdx
---
slug: kak-vybrat-kasko-v-kazahstane
lang: ru
contentType: guide
title: "Как выбрать КАСКО в Казахстане в 2025 году"
seoTitle: "Как выбрать КАСКО в Казахстане в 2025: покрытие, франшиза, исключения"
seoDescription: "Практический гид: как сравнить условия КАСКО, франшизу, исключения и ремонт, чтобы не получить отказ."
publishedAt: "2025-12-10"
modifiedAt: "2025-12-18"
readingTime: "12 мин"
image: "/blog/kasko-kz-hero.webp"
imageAlt: "КАСКО в Казахстане: автомобиль и страховой полис"
tags:
  - "Автострахование"
  - "Казахстан"
  - "Лайфхаки"
authorSlug: "denis-borovoy"
---
```

### Поля, которые у вас поддержаны сейчас

**Обязательные:**

* `slug`, `lang`, `title`, `seoDescription`

**Рекомендуемые:**

* `contentType` (если забыли — будет дефолт `"guide"`)
* `seoTitle` (если нет — берётся `title`)
* `publishedAt` (нужно для сортировки и мета; если криво — сортировка станет “слепой”)
* `image`, `imageAlt`, `tags`, `readingTime`, `authorSlug`

**Для FAQ (даёт и видимый блок, и JSON-LD):**

```yaml
faq:
  - q: "КАСКО обязательно в Казахстане?"
    a: "Нет, КАСКО добровольное..."
```

**Для “системы обучения” (явные связи):**

```yaml
requiredSlugs:
  - chto-takoe-franshiza-v-kasko
nextSlugs:
  - kak-sravnit-predlozheniya-kasko
```

**Для версионирования и Changelog:**

```yaml
version: "1.2"
changes:
  - "Обновили блок про франшизы"
  - "Добавили чек-лист проверки исключений"
```

---

## 3) Как писать текст: правила заголовков и TOC

TOC у вас строится **строго из сырого MDX** по регуляркам:

* `## Заголовок` → попадёт в TOC как уровень 2
* `### Подзаголовок` → попадёт как уровень 3
* `#` (H1) **в TOC не попадёт** (и не нужен, H1 у вас берётся из frontmatter `title`)

### Якоря (опционально, но полезно)

Поддерживается синтаксис:

```md
## Франшиза {#franshiza}
```

Если не указать `{#...}`, якорь будет сгенерирован из текста через `slugifyHeading()`.

**Рекомендация:** задавайте явные якоря для “вечных” статей (гайды/регламенты), чтобы ссылки не ломались при правках заголовков.

---

## 4) Какие “инструменты” доступны в MDX и как ими пользоваться

Ниже — то, что реально подключено в `compileMDX(components: { ... })`.

### 4.1 Callout — предупреждения / важно / подсказки

```mdx
<Callout kind="warn" title="Типовая ошибка">
  Клиенты сравнивают КАСКО “по цене”, не сравнивая условия по рискам и исключениям.
</Callout>
```

Используйте для:

* “важно”, “ошибка”, “совет”
* фиксации рисков отказа
* коротких выводов

### 4.2 Cta — отдельный призыв (блоком)

```mdx
<Cta
  title="Нужен расчёт КАСКО без сюрпризов?"
  text="Сравним 2–3 предложения на одинаковых условиях: риски, франшиза, исключения."
  href="/ru/contacts"
  button="Получить консультацию"
/>
```

Лучше ставить:

* 1 раз в верхней трети статьи (после первых 15–25% текста)
* 1 раз ближе к концу (после чек-листа/выводов)

### 4.3 InlineCta — “мягкий” CTA внутри текста

Хорош для статей, где нельзя быть “продающим”, но нужно конвертировать.

```mdx
<InlineCta
  title="Хотите, чтобы мы проверили условия перед оплатой?"
  text="Пришлите VIN/данные авто и 1–2 предложения — укажем рисковые места и что спросить у страховщика."
  href="/ru/contacts"
  button="Проверить условия"
/>
```

Ставьте:

* после блока “Типовые отказы / исключения”
* после таблицы сравнения
* после чек-листа “перед покупкой”

### 4.4 Table — ваш кастомный табличный компонент

```mdx
<Table
  caption="Сравнение 2 вариантов КАСКО"
  columns={["Параметр", "Вариант A", "Вариант B"]}
  rows={[
    ["Франшиза", "100 000 ₸", "0 ₸"],
    ["Ремонт", "СТО партнёра", "Официальный дилер"],
    ["Исключения", "Расширенные", "Стандартные"],
  ]}
/>
```

Используйте для:

* сравнения 2–3 вариантов
* чек-листов “что спросить у страховщика”
* “что входит/не входит”

### 4.5 Markdown-таблицы (GFM) + чекбоксы

У вас включён `remark-gfm`, а также переопределены теги `table/thead/tbody/tr/th/td` на `MdxTable*`, поэтому обычная markdown-таблица будет красиво рендериться.

```md
| Пункт проверки | Что сделать |
|---|---|
| Франшиза | Уточнить размер и условия применения |
| Ремонт | Где ремонтируют и как подтверждается ущерб |
```

Чекбоксы (GFM task list) тоже поддержаны и стилизованы через `input type="checkbox"`:

```md
- [ ] Проверить исключения по “грубому нарушению ПДД”
- [ ] Уточнить, покрывается ли стекло без справок
- [ ] Понять, как работает франшиза “по каждому событию”
```

### 4.6 Term — глоссарий (встраивание термина)

Вы подключили `Term` в `mdxHeadingComponents`. Обычно это выглядит так:

```mdx
<Term slug="franshiza">Франшиза</Term> — часть убытка, которую оплачивает клиент.
```

Рекомендация:

* используйте для 5–15 ключевых терминов в длинных гайдах
* не превращайте статью в “википедию”: термин — только там, где реально мешает пониманию

### 4.7 “Блоки оформления” из `components/blog/mdx/blocks/*`

В `lib/blog.tsx` подключены:

* `Lead` — лид-абзац/вводный блок
* `KeyTakeaway` — ключевой вывод
* `Divider` — разделитель
* `ScopeNote` — рамки материала (“о чём статья и чего не покрывает”)
* `FromPractice` — “из практики” (кейс/наблюдение)
* `UpdateNotice` — “обновлено/важно”
* `ContentStatus` — статус материала (“актуально”, “черновик”, “обновляется”)

Примерный стиль использования (без привязки к конкретным пропсам, потому что их интерфейсы вы не показали, но логика такая):

```mdx
<Lead>
  Этот гид — чтобы сравнивать КАСКО не по цене, а по условиям, которые влияют на выплату.
</Lead>

<ScopeNote>
  Разбираем: риски, исключения, франшизу, ремонт. Не разбираем: выбор конкретного страховщика по бренду.
</ScopeNote>

<KeyTakeaway>
  Сравнивайте 2–3 предложения на одинаковых входных данных и фиксируйте исключения письменно.
</KeyTakeaway>
```

---

## 5) Рекомендуемая структура статьи под брокерский блог

Эта структура хорошо работает и для SEO, и для доверия (без “продажности”).

1. **Лид и обещание результата**

* 4–6 строк: что узнает человек, что сможет сделать сам
* `<Lead>` + короткий список

2. **Контекст / кому подходит**

* 3–6 буллетов
* 1 Callout “частая ошибка”

3. **Основная часть: 3–6 секций `##`**

* каждый `##` отвечает на один кластер запросов
* внутри: `###`, таблица, чек-лист, кейс

4. **Чек-лист “перед покупкой”**

* task list + “что спросить / что получить письменно”

5. **FAQ в frontmatter**

* 5–10 вопросов, коротко, без воды
* важно: ответы должны быть **уникальными**, не копировать текст статьи дословно

6. **CTA (мягко)**

* после чек-листа: “проверим условия до оплаты”
* в конце: “подберём 2–3 варианта на одинаковых данных”

7. **Версия и изменения**

* `version + changes` (чтобы читатель видел, что материал живой)

---

## 6) Рекомендации по CTA: как не быть “продающим”, но конвертировать

### 6.1 Принцип: CTA = продолжение пользы

Плохой CTA: “Купите полис у нас”.
Нормальный CTA: “Проверим рисковые места до оплаты / объясним исключения / сравним условия на одинаковых данных”.

### 6.2 3 рабочих сценария CTA для страхового блога

**A) “Проверка условий” (лучший для доверия)**

* *Обещание:* найдём риск отказа, уточним вопросы, дадим список правок
* *Когда:* после блока про исключения/отказы

**B) “Сравнение 2–3 вариантов”**

* *Обещание:* сравним на одинаковом входе и сделаем таблицу
* *Когда:* после таблицы/в середине статьи

**C) “Чек-лист + консультация”**

* *Обещание:* вы уже прочитали — теперь применим к вашему случаю за 10–15 минут
* *Когда:* в конце

### 6.3 Текстовые формулы (готовые)

**Заголовки CTA:**

* “Проверим условия до оплаты”
* “Сравним 2–3 варианта на одинаковых данных”
* “Подскажем, какие исключения критичны именно вам”

**Текст:**

* “Пришлите 1–2 предложения/скрин условий — укажем, где чаще всего бывают отказы и что уточнить письменно.”

**Кнопка:**

* “Проверить условия”
* “Сравнить варианты”
* “Получить чек-лист вопросов”

### 6.4 Сколько CTA и где

Для статей 8–15 минут чтения:

* 1 InlineCta в середине (после “самого больного” места)
* 1 Cta в конце
  Больше — начинает выглядеть как продажа.

---

## 7) Чек-лист качества `.mdx` перед коммитом

**Frontmatter**

* [ ] `slug` = имя файла
* [ ] `lang` корректный
* [ ] `contentType` задан (или осознанно оставлен дефолт)
* [ ] `publishedAt` ISO `YYYY-MM-DD`
* [ ] `seoDescription` 140–170 символов, без “воды”
* [ ] `image` существует в `/public`
* [ ] `tags` 2–6 штук, консистентные (без дублей типа “Казахстан”/“KZ”)

**Тело**

* [ ] есть 3–6 секций `##`
* [ ] есть минимум 1 таблица или 1 чек-лист
* [ ] есть блок “типовая ошибка” (Callout) — почти всегда повышает доверие
* [ ] CTA “в тему”, а не “купите”
* [ ] нет “простыней”: абзац 3–5 строк, дальше перенос

**FAQ**

* [ ] вопросы — реальные, поисковые
* [ ] ответы — конкретные, не длиннее 3–6 строк

**Связи**

* [ ] `requiredSlugs/nextSlugs` существуют как файлы (иначе карточка будет пропущена)

---

## 8) Пример полноценного `.mdx` (скелет)

```mdx
---
slug: kak-vybrat-kasko-v-kazahstane
lang: ru
contentType: guide
title: "Как выбрать КАСКО в Казахстане в 2025 году: без «сюрпризов»"
seoTitle: "Как выбрать КАСКО в Казахстане в 2025: риски, франшиза, исключения"
seoDescription: "Гайд по выбору КАСКО: как сравнить покрытие, франшизу и исключения, чтобы не получить отказ в выплате."
publishedAt: "2025-12-10"
modifiedAt: "2025-12-18"
readingTime: "12 мин"
image: "/blog/kasko-kz-hero.webp"
imageAlt: "КАСКО в Казахстане: автомобиль и страховой полис"
tags:
  - "Автострахование"
  - "Казахстан"
  - "Лайфхаки"
authorSlug: "denis-borovoy"
requiredSlugs:
  - chto-takoe-franshiza
nextSlugs:
  - kak-sravnit-kasko
faq:
  - q: "КАСКО обязательно в Казахстане?"
    a: "Нет, КАСКО добровольное. Обязательным является ОСАГО."
  - q: "Что важнее цены в КАСКО?"
    a: "Исключения, франшиза и порядок ремонта — именно они чаще всего влияют на выплату."
version: "1.2"
changes:
  - "Добавили чек-лист по исключениям"
  - "Обновили примеры франшиз"
---

<Lead>
  Этот материал поможет сравнивать КАСКО не по цене, а по условиям, которые решают судьбу выплаты.
</Lead>

<Callout kind="warn" title="Типовая ошибка">
  Сравнивают стоимость, но не читают исключения. Потом удивляются отказу.
</Callout>

## С чего начать сравнение {#start}

- [ ] Определите риски: угон, тотал, стекло, стихийные, ДТП
- [ ] Зафиксируйте входные данные одинаковыми (год, стоимость, водитель, регион)

## Франшиза: как не ошибиться {#franshiza}

<Term slug="franshiza">Франшиза</Term> — часть убытка, которую вы оплачиваете сами.

<Table
  caption="Типовые варианты франшизы"
  columns={["Вариант", "Как работает", "Кому подходит"]}
  rows={[
    ["0 ₸", "страховщик платит с первого тенге", "новое авто, дорогой ремонт"],
    ["100 000 ₸", "вы платите первые 100 000 ₸", "когда мелкие убытки не критичны"],
  ]}
/>

<InlineCta
  title="Хотите, чтобы мы проверили условия франшизы до оплаты?"
  text="Пришлите предложение — укажем, где франшиза “скрыта” в формулировках."
  href="/ru/contacts"
  button="Проверить условия"
/>

## Исключения: где чаще всего отказывают {#exclusions}

- [ ] “грубое нарушение ПДД” — уточнить, что сюда входит
- [ ] управление в состоянии опьянения — обычно исключение всегда
- [ ] несоответствие данных в заявлении — проверяйте анкету

## Чек-лист перед покупкой {#checklist}

- [ ] Получить правила + спецусловия + заявление (не только “коммерческое”)
- [ ] Письменно уточнить: ремонт (дилер/СТО), сроки, документы
- [ ] Уточнить порядок уведомления и осмотра

<Cta
  title="Нужна проверка перед оплатой?"
  text="Сравним 2–3 варианта на одинаковых данных и покажем рисковые места условий."
  href="/ru/contacts"
  button="Получить консультацию"
/>
